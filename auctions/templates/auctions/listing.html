{% extends "auctions/layout.html" %}

{% block body  %}
<h2>{{ listing.title }}</h2>
<p><strong>Category:{{listing.category}}</strong></p>
<p>{{ listing.description }}</p>
<p>Starting Bid: ${{ listing.starting_bid }}</p>

{% if listing.image_url %}
    <img src="{{ listing.image_url }}" alt="{{ listing.title }}">
{% endif %}

<form action="{% url 'add_to_watchlist' listing.id %}" method="post">
    {% csrf_token %}
    <button type="submit">
        {% if user in listing.watchlist.all %}
            Remove from Watchlist
        {% else %}
            Add to Watchlist
        {% endif %}
    </button>
</form>


{% if listing.bids.exists %}
<p>Current Highest Bid: ${{ listing.bids.last.amount }}</p>
{% else %}
<p>No bids placed yet.</p>
{% endif %}


{% if message %}
<p>{{ message }}</p>
{% endif %}


<form method="post" action="{% url 'place_bid' listing.id %}">
{% csrf_token %}
<label for="bid">Your Bid:</label>
<input type="text" id="bid" name="bid" required>
<button type="submit">Place Bid</button>
</form>




{% if request.user == listing.user or listing.is_active %} 
<form method="post" action="{% url 'close_auction' listing.id %}">
    {% csrf_token %}
    <button type="submit">Close Auction</button>
</form>
{% endif %}


{% if messages %}
<ul>
    {% for message in messages %}
        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}
{% if user.is_authenticated %}
    <form action="{% url 'add_comment' listing.id %}" method="post">
        {% csrf_token %}
        <textarea name="comment"></textarea>
        <button type="submit">Post Comment</button>
    </form>
{% endif %}


<h2>Comments</h2>
{% if listing.comments.all %}
    <ul>
        {% for comment in listing.comments.all %}
            <li><strong>{{ comment.user.username }}</strong>: {{ comment.content }}</li>
        {% endfor %}
    </ul>
{% else %}
    <p>No comments yet.</p>
{% endif %}


{% endblock  %}

